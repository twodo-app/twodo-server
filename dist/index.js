parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"S6ww":[function(require,module,exports) {
const e=require("shortid"),t={id:String,userid:String,title:String,description:String,priority:Number,created:Number,due:Number,estimated:Number,timetaken:Number,snoozed:Boolean,complete:Boolean},r={userid:String,title:String,description:String,priority:Number,created:Number,due:Number,estimated:Number},i=["id","userid","created","timetaken"],d=e=>Object.keys(r).reduce((t,i)=>typeof e[i]==typeof r[i]()&&t,!0),o=e=>Object.keys(t).reduce((r,i)=>typeof e[i]==typeof t[i]()&&r,!0),a=(e,t)=>i.reduce((r,i)=>e[i]===t[i]&&r,!0),m=t=>({id:e.generate(),userid:t.userid,title:t.title,description:t.description,priority:t.priority,created:t.created,due:t.due,estimated:t.estimated,timetaken:0,snoozed:!1,complete:!1}),n=()=>m({userid:"test-user",title:"I am a mock twodo",description:"Use me to test the API!",priority:3*Math.random()|0,created:Date.now(),due:Date.now()+1e5*Math.random(),estimated:Date.now()+1e5*Math.random()});module.exports={validateRequired:d,validateComplete:o,validateUpdate:a,create:m,mock:n};
},{}],"/ZIk":[function(require,module,exports) {
module.exports={OK:200,CREATED:201,NO_CONTENT:204,NOT_MODIFIED:304,BAD_REQUEST:400,UNAUTHORISED:401,FORBIDDEN:403,NOT_FOUND:404,CONFLICT:409,INTERNAL_SERVER_ERROR:500};
},{}],"jx0t":[function(require,module,exports) {
const t=require("shortid"),{OK:e,CREATED:s,BAD_REQUEST:o,NOT_FOUND:r}=require("../status.js"),d=require("../todo.js");module.exports={get:{all:t=>(s,o)=>{const r=t.get("todos").value();o.status(e).json(r)},filtered:t=>(e,s)=>{const o=[];"true"!==e.query.complete&&"false"!==e.query.complete||o.push(t=>t.complete===JSON.parse(e.query.complete)),"true"!==e.query.snoozed&&"false"!==e.query.complete||o.push(t=>t.snoozed===JSON.parse(e.query.snoozed)),isNaN(parseInt(e.query.priority))||o.push(t=>t.priority===parseInt(e.query.priority));const r=o.reduce((t,e)=>t.filter(e),t.get("todos")).value();r.length>0?s.status(200).json(r):s.status(404).json(r)},byID:t=>(s,o)=>{const d=t.get("todos").find({id:s.params.id}).value();null==d?o.status(r).json({}):o.status(e).json(d)}},post:{create:t=>(e,r)=>{if(!e.body)return r.sendStatus(o);if(!d.validateRequired(e.body))return r.sendStatus(o);const a=d.create(e.body);t.get("todos").push(a).write(),r.status(s).json(a)},update:t=>(s,a)=>{const u=t.get("todos").find({id:s.params.id}).value();if(!u)return a.sendStatus(r);if(!s.body)return a.sendStatus(o);if(!d.validateComplete(s.body))return a.sendStatus(o);const n={};for(const t in u)n[t]=s.body.hasOwnProperty(t)?s.body[t]:u[t];if(!d.validateUpdate(n,u))return a.sendStatus(o);t.get("todos").find({id:s.params.id}).assign(n).write(),a.status(e).json(n)}},delete:{byID:t=>(s,o)=>{if(!t.get("todos").find({id:s.params.id}).value())return o.sendStatus(r);t.get("todos").remove({id:s.params.id}).write(),o.sendStatus(e)}}};
},{"../status.js":"/ZIk","../todo.js":"S6ww"}],"6KBv":[function(require,module,exports) {
module.exports={todos:require("./todos.js")};
},{"./todos.js":"jx0t"}],"np2C":[function(require,module,exports) {
const e=require("shortid"),{OK:s,CREATED:t,BAD_REQUEST:r,NOT_FOUND:a}=require("../status.js"),o=require("../todo.js");module.exports={get:{filtered:e=>(s,t)=>{const r=[];"true"!==s.query.complete&&"false"!==s.query.complete||r.push(e=>e.complete===JSON.parse(s.query.complete)),"true"!==s.query.snoozed&&"false"!==s.query.complete||r.push(e=>e.snoozed===JSON.parse(s.query.snoozed)),isNaN(parseInt(s.query.priority))||r.push(e=>e.priority===parseInt(s.query.priority));const a=r.reduce((e,s)=>e.filter(s),e.get("todos").filter({userid:s.params.user})).value();a.length>0?t.status(200).json(a):t.status(404).json(a)},byID:e=>(t,r)=>{const o=e.get("todos").get(t.params.user).find({id:t.params.id}).value();null==o?r.status(a).json({}):r.status(s).json(o)},byUser:e=>(t,r)=>{const o=e.get("todos").filter({userid:t.params.user});0==o.length?r.status(a).json([]):r.status(s).json(o)}},post:{create:e=>(s,a)=>{if(!s.body)return a.sendStatus(r);if(!e.get("users").find(s.params.user).value())return a.sendStatus(r);if(!o.validateRequired(s.body))return a.sendStatus(r);const u=o.create(s.body);e.get("todos").push(u).write(),console.log(e.get("todos").value()),a.status(t).json(u)},update:e=>(t,u)=>{const d=e.get("todos").find({id:t.params.id,userid:t.params.user}).value();if(!d)return u.sendStatus(a);if(!t.body)return u.sendStatus(r);if(!o.validateComplete(t.body))return u.sendStatus(r);const i={};for(const e in d)i[e]=t.body.hasOwnProperty(e)?t.body[e]:d[e];if(!o.validateUpdate(i,d))return u.sendStatus(r);e.get("todos").find({id:t.params.id,userid:t.params.user}).assign(i).write(),u.status(s).json(i)}},delete:{byID:e=>(t,r)=>{if(!e.get("todos").find({id:t.params.id,userid:t.params.user}).value())return r.sendStatus(a);e.get("todos").remove({id:t.params.id,userid:t.params.user}).write(),r.sendStatus(s)}}};
},{"../status.js":"/ZIk","../todo.js":"S6ww"}],"Th8i":[function(require,module,exports) {
const e=require("shortid"),{CREATED:s}=require("../status.js");module.exports={get:{newUser:t=>(r,u)=>{const o=e.generate();t.get("users").push(o).write(),u.status(s).json(o)}}};
},{"../status.js":"/ZIk"}],"Ouoj":[function(require,module,exports) {
module.exports={todos:require("./todos.js"),user:require("./user.js")};
},{"./todos.js":"np2C","./user.js":"Th8i"}],"VO5s":[function(require,module,exports) {
const e={test:require("./test/index.js"),v1:require("./v1/index.js")};module.exports=(t=>{switch(t){case"test":return console.log("loading test api"),e.test;case"v1":return console.log("loading v1 api"),e.v1;default:return e.test}});
},{"./test/index.js":"6KBv","./v1/index.js":"Ouoj"}],"Focm":[function(require,module,exports) {
const e=require("express"),o=require("body-parser"),t=require("cors"),s=require("lowdb"),d=require("lowdb/adapters/Memory"),r=require("./api/todo.js"),i="db",u=process.env.PORT||3e3,p=process.env.VERSION,a=`/api/${p}`,l=s(new d("db.json"));"test"!==p?l.defaults({todos:[],users:["andy","trymunx"]}).write():l.defaults({todos:[r.mock(),r.mock(),r.mock(),r.mock()]}).write();const n=e();n.use(o.json()),n.use(t());const c=require("./api")(p);switch(p){case"test":n.get(`${a}/todos`,c.todos.get.all(l)),n.get(`${a}/todos/filter?`,c.todos.get.filtered(l)),n.get(`${a}/todos/:id`,c.todos.get.byID(l)),n.post(`${a}/todos`,c.todos.post.create(l)),n.post(`${a}/todos/:id`,c.todos.post.update(l)),n.delete(`${a}/todos/:id`,c.todos.delete.byID(l));break;case"v1":n.get(`${a}/user`,c.user.get.newUser(l)),n.get(`${a}/todos/:user`,c.todos.get.byUser(l)),n.get(`${a}/todos/:user/:id`,c.todos.get.byID(l)),n.get(`${a}/todos/:user/filter?`,c.todos.get.filtered(l)),n.post(`${a}/todos`,c.todos.post.create(l)),n.post(`${a}/todos/:user/:id`,c.todos.post.update(l)),n.delete(`${a}/todos/:user/:id`,c.todos.delete.byID(l))}n.listen(u,"0.0.0.0",()=>{console.log(`Server running on port ${u}`)});
},{"./api/todo.js":"S6ww","./api":"VO5s"}]},{},["Focm"], null)
//# sourceMappingURL=/index.map